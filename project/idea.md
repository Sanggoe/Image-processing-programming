### 초기 아이디어

- 사진 인식 처리...
  - 사진을 PDF로...? 가능?
  - 명함 인식
  - 글자 인식
- 모션 동작 인식 잠금장치?
- 그림판?
- 게임 종류
  - 틀린그림 찾기?
  - 적군 아군 판별 카메라?

<br/>

<br/>

### 배운 영역

- 영상 읽고 출력하기
- 도형 그리기
- **창 관리 및 이벤트 처리**
- **관심영역 표시하기 (ROI)**
- **트랙바 이용하기**
- **이미지 색상 표현 방식 - 알파채널, 색상, 밝기, 채도 분리 응용하기(BGR, HSV, YUV)**
- 임계점 기준으로 흑/백 분리 (Thresholding, Otsu's Method)
- 합성 (이미지 연산, 알파 블렌딩, 마스킹 등)
- 화질 개선, 밝기 조절 (히스토그램과 정규화, 평탄화, 부분 평탄화 CLAHE)
- 관심 영역 유사 이미지 추출 (2차원 히스토그램, 역투영)
- 이미지 유사도 비교
- **이미지 이동, 확대/축소, 회전**
- 이미지 뒤틀기 (Affine 변환, 원근 변환)
- 필터

<br/>

<br/>

### 피드백 1

* 결과가 멋있는게 중요한게 아니다. 코드를 얼마나 열심히 짰느냐?
* 알아서 다해주는거를 해주는것 보다는.. 내가 코드를 짜는게 중요하다.
* 중간보고서는 개발 일정 중요!
* 함수 파라미터가 뭐고 반환을 뭘로하고 무슨 역할을 수행하고 등등 구체적인 설명이 필수적이다.
* 최종보고서는 ppt 발표 동영상

<br/>

<br/>

### 피드백 2

* 문제가 되는 주제?

  * 손글씨인식

  * 글자인식 OCR

    * 머신러닝 문제.

    * "영상처리" 하는 프로젝트를 만들어라~
    * 한 두가지 넣는건 상관 없다. But 영상처리가 주목적

  * 포토샵

    * 지금까지 해본거 하나하나 해보겠다는 걸로 끝나요.

  * 얼굴인식(노 마스크 찾기)

    * 얼굴 인식도 마찬가지. 알고리즘이 뒤에 나와 있어서.. 그거 쓰면 끝!

* 배운걸 가지고 하나의 주제를 녹여내서 어떤 목적을 이루느냐!!
* 배운 내용을 가지고 어떻게 엮어서 내 프로그램으로 만들어 내느냐!!
* 내가 한 결과를 원함. 내가 한 코드... 그러면 어떻게 해야할까...

<br/>

<br/>

### 수정 1

* 이미지를 png 로 변환하는 부분에 집중하기로!
* 최종 목표는 해당 이미지를 합성. 옷 코디 시뮬레이션 하는 프로그램
* 오늘 오목, 볼록을 배워서 그거 응용하면 어떨까? 
  * 등치 큰 사람 볼록 / 마른사람 오목...
* 전처리 영역이 중요하다.
* 어떤 영역을 인식하는건지!!!?
* 어디에 중점을 둘 것인지...? 알파 채널!

<br/>

<br/>

### 피드백 3

* 오목, 볼록을 방사형으로 하는건 fitting에 부적합.
* GUI에 시간 최소화.

<br/>

<br/>

# 시작!!

### 이미지를 저장하는 방법

1. 옷을 선택해서 저장하는 방법
2. 배경을 선택해서 삭제하는 방법

<br/>

### 이미지를 추출하는 방법

1. 옷이 단색일 경우
2. 밝기가 동일할 경우
3. 배경이 단색일 경우
4. 옷이 알록달록한 색일 경우
5. 밝기가 다 다를 경우
6. 배경과 옷 색깔이 비슷할 경우
7. 추출할건 바지인데 옷과 색이 비슷할 경우

<br/>

### 이미지를 추출하는 과정


1. 임의로 roi 영역을 1차로 잡아서 최대한 해당하지 않는 영역을 잘라낸다.

2. 역투영 방식, 우선 최대한 겹치지 않는 부분으로 선택, 원하는 영역이 선택이 안되고 
가운데 뚫린 부분이 있는 한이 있더라도, "해당하지 않는 부분이 선택되지 않는 것을 우선적으로" 선택.

3. 스레시홀드 방식. 마찬가지, 최대한 겹치지 않는 부분으로 선택, 원하는 영역이 선택이 안되고 
가운데 뚫린 부분이 있는 한이 있더라도, "해당하지 않는 부분이 선택되지 않는 것을 우선적으로" 선택.

4. 마스킹 방식. 마찬가지, 최대한 겹치지 않는 부분으로 선택, 원하는 영역이 선택이 안되고 
가운데 뚫린 부분이 있는 한이 있더라도, "해당하지 않는 부분이 선택되지 않는 것을 우선적으로" 선택.

5. 위 2~4 번에서 선택된 영역은 우선 임시 저장. 그리고 나머지 부분은 추가로 다시 roi 잡아서 해당
영역과 bit_wise 연산을 통해 뚫린 부분 메꾸기?

<br/>

1. 원본 이미지 또는 roi 이미지의 shape가 똑같고 같은 zero로 초기화된 numpy 배열을 하나 만든다.

2. 선택된 영역만 numpy 배열에 집어 넣는 방법 등으로 이미지를 추출해낸다.

<br/>

#### 이미지 numpy 배열

* 이미지를 img에 읽어온다.
* cv2.cvtColor()에 cv2.COLOR_BGR2BGRA flag를 통해 shape을 변경해준다.
* img.shape은 y축 크기, x축 크기, 채널의 크기(BGRA로 4) 이다.
* img[:, :, [3]]이 알파채널이므로, 값이 0이면 100% 투명해진다.
* 값이 255이면 0% 투명 즉, 다른말로 완전히 불투명해진다.
* 따라서 선택한 영역의 알파채널은 보여져야 하므로 값이 255이어야 한다.
* 배경 등 영역의 알파채널은 지우고 싶은 영역이므로 값이 0이어야 한다.
* 이를 위해, 색깔이 존재하는 부분의 알파채널은 255, 0인 부분은 0으로 바꾸는 연산을 수행한다.



* 관심영역의 알파채널을 255로 (색깔 있는 부분은 보이게)
  * 색깔 있는 부분은 보이게
    * [0] or [1] or [2]의 좌표에 0이 아닌 값이 들어있는 경우 [3]의 값을 255로 만들어주는 알고리즘
  * 선택된 배열의 좌표 값과 bitwise_and 연산
    * y축 좌표, x축 좌표에 해당하는 [3]의 값을 255로 만들어주는 알고리즘
* 관심 외 영역의 알파채널을 0으로 (배경은 안보이게)
  * 



<br/>

### 프로그램 Process

1. 실행 및 불러오기

   * 편집할 이미지에 대해 text로 파일 경로를 입력한다.
   * 존재하는 이미지인지 판단하여 옳은 경로를 입력할 때까지 반복한다.
   * 경로에 해당하는 이미지를 띄운다.

   

2. 이미지 편집 선택

   * 키보드 입력으로 원하는 편집 함수를 수행한다.
     * i : 처음 이미지로 초기화
     * s : 현재 창 이미지 저장
     * ? : 저장될 이미지 미리보기
       * t : 임시 영역 생성 및 저장??
       * ctrl + b : 임시 영역에 선택 영역 bit_wise 연산 수행??
     * r : roi 선택
     * +: 이미지 확대
     * -: 이미지 축소
     * 1 : 역투영(backproject) 기능 시작
     * 2 : 쓰레시홀드(threashhold) 기능 시작
     * 3 : hsv 마스킹(mask) 기능 시작
     * 4 : 영상들에 대한 노이즈 제거 작업 시작
     * ESC : 종료



* 이미지 배열 요소
  1. 원본 이미지 img - 변하지 않음
  2. 복사 이미지 img_copy - jpg 파일
  3. 알파채널 저장 img_mask
     * 알파 채널을 255로 만드는 연산 (보이게)
     * 알파 채널을 0으로 만드는 연산 (안 보이게)
  4. 미리보기
     * img_copy와 img_mask를 bitwise_and 연산을 시켜 미리보기
  5. 저장
     * img_copy와 img_mask를 bitwise_and 연산 시켜 저장하기
     * img_result 최종 png 저장본







#### 보고서에 설명 넣을 부분

1. 전체 프로그램 구동 순서도 도식화

2. 이미지 연산 방법 예시들
   * ROI로 영역 선택
   * 색상으로 뽑기, 이진화 하여 뽑기, 역투영 시켜 뽑기
     * 뽑은 영역 저장할 임시 이미지 영역에 bitwise 연산으로 추가 / 제거 하기
     * 알파 채널을 0으로 또는 255로 만들어서 연산??
     * BGR 값을 0으로 만들어서 연산??
       * 검정색을 표현하고 싶은 경우도 있으니.. 이건좀..?
     * 임시 이미지 영역 미리보기 기능
       * 이진화로 보기
       * 칼라로 보기
   * 임시 이미지 영역에 대해 노이즈 제거 기능
     * 임시 이미지 영역 미리보기 기능
       * 이진화로 보기
       * 칼라로 보기
   * 임시 이미지 영역 png로 저장하기

3. 각 연산들 수행 화면, 결과들
4. 장단점들, 보완점들
5. 코드들 설명





### 사용된 기술들

* 창 관리 및 이벤트 처리
* 관심영역 ROI 선택
* 트랙바
* 역투영
* 쓰레시 홀드
* 비트와이즈 연산
* 이미지 확대/축소
* 노이즈 처리 (예정)



### 1. 역투영

#### back_project()

* **원본이미지** `BGR to HSV` 변환하여 **img_hsv** 저장
* **원본이미지**에서 **roi** 추출
* **roi** 이미지 `BGR to HSV` 변환하여 **roi_hsv** 저장
* **roi_hsv**로 `히스토그램` 구해 **roi_hist** 저장
* **img_hsv**, **roi_hist**로 `역투영` 이미지 구해 **img_backproject** 저장
* **masking** 함수에 **img_backproject**, **원본 이미지** 넘겨 호출



#### masking()

* **img_backproject** 표면 부드럽게 `컨볼루션` 연산
  * 다른 기능들에도 이 연산 적용 필요할 듯
  * 아니면 이진화 리스트에는 `모폴로지` 연산 적용 필요할 듯
* **img_backproject** 0이 아니면 모두 255로 바꿔 `쓰레시 홀딩`한 결과 **mask_backproject** 저장
* 출력을 위해 **원본 이미지**, **mask_backproject** 를 `bitwise_and` 연산 수행한 결과 **img_result** 저장
  * **mask_backproject** 과 `bitwise_and` 연산 이용해 `알파채널` 저장 가능!
* **img_result** 출력



#### 개선할 사항

* 기존에 구현된 내용은 `미리보기 `기능으로 두고, `저장` 기능을 추가할 필요 있을 듯 함
* **img_result** 를 저장하는 기능







### 최종 발표 순서

* 내용설명 - 시연 - 코드설명